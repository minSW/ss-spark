# Introduction of Spark

## 스파크(Spark) 란? 
* 대규모 데이터 처리를 위한 통합 분석 엔진, \
클러스터 환경에서 데이터를 병렬로 처리하는 라이브러리 집합.
* In-memory 연산 처리 엔진으로, \
데이터가 disk 대신 RAM에 저장되며 병렬 처리 된다.
* 스파크는 스파크 애플리케이션(Spark Application)과 클러스터 매니저(Cluster Manager)로 구성된다.
  - 스파크가 지원하는 클러스터 매니저 종류
    + 스파크 스탠드얼론(standalone) 클러스터 매니저
    + 하둡(Hadoop) YARN
    + 메소스(Mesos)
* 스파크는 클러스터에 스파크 애플리케이션을 제출해서 사용하는데, \
로컬(local) 모드도 지원하여, 클러스터 없이도 사용할 수 있다. \
(단, 클러스터를 사용하지 않으므로 성능이 나쁘다.)

### 스파크 애플리케이션(Spark Application)
* 하나의 드라이버(Driver) 프로세스와 다수의 익스큐터(Executor) 프로세스로 구성

#### 드라이버 프로세스(Driver Process)
* 스파크 애플리케이션 정보의 유지 관리
* 사용자 프로그램이나 입력에 대한 응답
* 익스큐터 프로세스의 작업과 관련된 분석, 배포 그리고 스케줄링 

#### 익스큐터 프로세스(Executor Process)
* 드라이버가 할당한 코드 실행 및 결과 보고

![Spark The Definitive Guide 참조](./SparkStructure.png)
* 드라이버 프로세스는 클러스터 매니저에게 익스큐터에 필요한 자원을 요청 및 할당 받는다.
* 즉, 자원에 관한 것은 클러스터 매니저에서 관리하다.

### SparkSession
* SparkSession 인스턴스는 사용자 코드(User code)을 클러스터에서 실행한다.
* SparkSession과 스파크 애플리케이션은 1:1 관계를 가진다.

### DataFrame
* 가장 대표적은 구조적 API로, 테이블의 데이터를 로우와 컬럼으로 표현한다.
* 스키마(schema): 컬럼과 컬럼의 타입을 정의
* 일반적으로 여러대의 클러스터의 분산되어 저장되어 있다.

### 파티션(Partitions)
* 클러스터의 물리적 머신에 존재하는 로우의 집합으로, \
모든 익스큐터에서 병렬로 작업을 수행할 수 있도록 테이블을 나눈 단위.
* 하지만 익스큐터와 파티션은 분리 가능하다.
* 익스큐터가 1개라도, 파티션은 수백개 존재할 수 있고 그 반대도 가능하다. \
(단, 병렬성은 둘의 최소값인 1이 된다.)

### 트랜스포메이션(Transformation)
* DataFrame을 변경하는 방법(연산?)
* 트랜스포메이션은 추상적이라서, 액션 명령이 있기 전까지 수행되지 않는다.
* 좁은 의존성(narrow dependency)
    - 각 입력 파티션이 하나의 출력 파티션에만 영향을 미친다. (1:1)
    - 파이프라이닝(pipelining)
* 넓은 의존성(wide dependency)
    - 하나의 입력 파티션이 여러 출력 파티션에 영향을 미친다. (1:N)
    - 셔플(shffle): 클러스터에서 파티션을 교환하는 작업.
        + **셔플의 결과는 메모리가 아닌 디스크**에 저장된다.
* 지연 연산(Lazy evaluation)
    - 스파크는 특정 연산 명령이 내려진 즉시 수행하는 것이 아니라 \
    원시 데이터에 적용할 트랜스포메이션의 실행 계획을 생성한다.

### 액션(action)
* 일련의 트랜스포메이션으로부터 결과를 계산하도록 지시하는 명령.

![Example_explain](./sparkCode1.png)

