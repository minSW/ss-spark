# 3주차 정리

## 8장 join

- left table . join (right, expression, type) 과 같은 형식을 통하여 join 할 수 있다.
- 외부 조인의 경우에 일치하는 로우가 없다면 Null로 들어간다.
- 자연 조인을 사용하는 경우에 명시적으로 사용하자..
- 교차 조인은 위험
- 239 해결 방법 1이 좀 이해가...
- 네트워크 통신 전략 : 셔플 조인 (전체 노드 간 통신을 유발하는), 브로드캐스트 조인 (그렇지 않은)
- 브로드 케스트 조인은 작은 테이블을 워커노드에 복제하는 것을 의미 -> 테이블이 너무 큰 경우는 터짐.. -> 한번 올리면 다음 워커를 기다릴 필요 없이 바로 작업을 수행할 수 있음.
- 242 cpu가 가장 큰 병목 구간이다. (이말의 의미가 정확히 어떤걸 의미하나?.. 싶네)
- 작은 테이블의 조인은 스파크에게 결정권을 주자..
- 조인 전에 데이터를 적절하게 분할하면 셔플이 계획되어 있더라도 동일한 머신에 두 데이타 프레임의 데이터가 있을 수 있다. 따라서 셔플을 피하고 더 효율적으로 실행할 수 있다.

## 9장
- CSV : 운영환경에서는 어떤 내용이 들어 있는지, 어떠한 구조로 되어 있느느지 등 다양한 전제를 만들어낼 수 없기 때문 그래서 옵션을 많이 제공...
- 스파크는 지연 연산 특성이 있으므로 DataFrame 정의 시점이 아닌 잡 실행 시점에만 오류가 발생한다고 한다,,, 
- 파케이 파일은 json, csv 보다 훨씬 효율적으로 동작하므로 장기 저장용 데이터는 파케이로 저장하자..
- orc, 파케이는 비슷하지만 파케이는 스파크에 최적화, orc는 하이브에 최적화되어 있다...
- 쿼리 푸시다운이란? : dataFrame을 만들기 전에 데이터베이스 자체에서 데이터를 필터링하도록 만들 수 있다.
- numPartitions를 통하여 읽기 및 쓰기용 동시 작업 수를 제한할 수 있는 최대 파티션 수를 설정할 수 있다..
- 필터를 데이터베이스에 위임하여 결과를 반환 받을 수 있지만, 스파크 자체 파티션에 결과 데이터를 저장함으로써 더 많은 처리를 할 수 도 있다.
- 추천하는 파일 포맷과 압축 방식은 파케이 파일 포맷과 GZIP 압축 방식이라 한다.. 모든 압축 방식이 분할 압축을 지원하지는 않는다.
- 파티셔닝을 통하여 데이터를 읽을 때 전체 데이터셋을 스캔하지 않고 필요한 컬럼의 데이터만 읽을 수 있다. 성능적 이점.!!!
- 버켓팅 각 파일에 저장된 데이터를 제어할 수 있는 또 다른 파일 조직화 기법.데이터가 이후의 사용 방식에 맞춰 사전에 파티셔닝되므로 조인이나 집계 시 발생하는 고비용의 셔플을 피할 수 있다.
- 파일 크기를 관리하는 것은 데이터를 저장할 때는 중요한 요소가 아니다. 하지만 데이터를 읽을 때는 중요한 요소 중 하나다. 작은 파일을 많이 생성하면 메타데이터에 엄청난 관리 부하가 발생한다. 그래서 maxRecordsPerFile을 이용하여 적당한 파일 크기를 조절할 수 있다. (너무 작아도 별로 너무 커도 별로..)